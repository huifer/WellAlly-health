# 症状模式分析器技能设计

## 概述
**技能名称**: `symptom-pattern-analyzer`
**目的**: 分析症状模式、识别诱因、与药物和生活方式因素关联，并提供可操作的洞察。

## 描述
分析一段时间内的症状模式以识别诱因、与药物/生活方式的关联、频率趋势和潜在原因。在追踪症状、调查健康问题或询问"为什么我一直有这些症状？"时使用。

## 数据集成

### 数据源
- **症状记录** (`data/symptoms/`): 主要症状记录
- **药物记录** (`data/medications/`): 关联症状与药物
- **过敏信息** (`data/allergies.json`): 识别过敏相关症状
- **饮食记录** (`data/diet/`): 关联症状与食物摄入
- **情绪记录** (`data/mood/`): 心理健康相关性
- **周期记录** (`data/cycle/`): 激素/月经相关性
- **睡眠**（如追踪）: 睡眠质量相关性

### 相关命令
- `/symptom`: 症状记录的主要命令
- `/allergy`: 过敏症状追踪
- `/medication`: 副作用追踪
- `/mood`: 心理健康追踪

## 核心功能

### 1. 症状模式检测
- **频率分析**: 症状发生频率
- **时间模式**: 一天中的时间、一周的哪一天、季节性模式
- **严重程度趋势**: 症状是否好转或恶化
- **持续时间分析**: 症状通常持续多久
- **聚类**: 将一起出现的相关症状分组

### 2. 诱因识别
- **食物诱因**: 与饮食记录关联
- **药物诱因**: 副作用、相互作用
- **环境诱因**: 天气、过敏原、污染
- **生活方式诱因**: 睡眠、压力、运动
- **激素诱因**: 月经周期模式
- **活动诱因**: 运动、工作、姿势

### 3. 根本原因分析
- **鉴别症状**: 区分相似症状
- **潜在模式**: 识别根本原因
- **合并症检测**: 识别症状簇
- **红旗警示检测**: 识别需要医疗关注的令人担忧的模式

## 输出格式

### 症状模式报告
```
🔍 症状模式分析
生成时间: 2025-12-31
分析周期: 过去 3 个月

📊 症状概览
├─ 总症状发作: 47 次
├─ 独特症状: 8 种不同类型
├─ 最频繁: 头痛（15 次）
├─ 最严重: 偏头痛（3 次，严重程度 8/10）
└─ 趋势: 总体症状频率下降 23%

🎯 重点症状分析

1. 头痛（15 次发作）
   ├─ 频率: 平均 5 次/月
   ├─ 严重程度: 平均 6/10（中度）
   ├─ 持续时间: 通常 4-8 小时
   ├─ 趋势: 下降（从 7 次降至 3 次/月）
   ├─ 时间: 主要在下午（2-5 PM）
   └─ 持续时间: 改善中

   🕵️ 识别的诱因:
   ├─ 强相关: 睡眠不足（<6 小时）- 80% 相关性
   ├─ 中度相关: 工作压力 - 65% 相关性
   ├─ 中度相关: 屏幕时间 >4 小时 - 60% 相关性
   └─ 弱相关: 某些食物 - 30% 相关性

   💊 药物相关性:
   ├─ 布洛芬有效: 服用时 90% 有效
   ├─ 副作用: 未识别
   └─ 赖诺普利: 无相关性

   ✅ 建议:
   ├─ 优先级: 改善睡眠卫生（最强诱因）
   ├─ 每小时从屏幕休息
   ├─ 工作场所压力管理技巧
   └─ 如果频率增加考虑预防药物

2. 恶心（8 次发作）
   ├─ 频率: 2-3 次/月
   ├─ 严重程度: 平均 4/10（轻中度）
   ├─ 趋势: 稳定
   └─ 时间: 早晨（70%）

   🕵️ 识别的诱因:
   ├─ 强相关: 空腹服用二甲双胍 - 85% 相关性
   ├─ 中度相关: 高脂饮食 - 50% 相关性
   └─ 弱相关: 压力 - 30% 相关性

   ✅ 建议:
   ├─ 总是随餐服用二甲双胍
   ├─ 更少量更频繁的饮食
   └─ 如果持续与医生讨论

📈 相关性矩阵
           | 睡眠 | 压力 | 饮食 | 药物 | 周期
-----------|-------|--------|------|------|-------
头痛       |  80%  |  65%   | 30%  |  0%  |  10%
恶心       |  20%  |  30%   | 50%  | 85%  |   0%
疲劳       |  75%  |  40%   | 55%  | 10%  |  20%
焦虑       |  60%  |  90%   | 20%  |  5%  |  70%

⚠️ 红旗警示
├─ 未检测到
└─ 继续当前监测

🎯 优先行动
1. 改善睡眠卫生（解决 3 个主要症状）
2. 随餐服用二甲双胍（消除恶心诱因）
3. 工作场所压力管理
4. 考虑预防性头痛策略

📊 进度追踪
├─ 头痛频率: ✅ 改善中
├─ 总体症状负担: ✅ 下降 23%
├─ 新症状: 无
└─ 已解决症状: 头晕（2 个月前已解决）
```

## 用户交互示例

### 示例 1: 一般症状分析
**用户**: "我最近经常头疼。能帮我分析一下原因吗？"
**技能**: 分析头痛模式，识别诱因，提供详细报告

### 示例 2: 诱因识别
**用户**: "是什么导致我恶心？"
**技能**: 与饮食、药物、时间关联，识别可能原因

### 示例 3: 症状追踪
**用户**: "我的症状是在好转还是恶化？"
**技能**: 提供趋势分析，显示随时间的改善/恶化

### 示例 4: 多种症状
**用户**: "我有头痛、恶心和疲劳。它们之间有联系吗？"
**技能**: 分析症状簇，识别共同诱因

## 安全与伦理

### 重要规则
1. **绝不诊断** - 仅识别模式和相关性
2. **始终建议咨询医生** - 针对严重或恶化症状
3. **始终包含免责声明** - 关于局限性
4. **识别红旗警示** - 需要立即医疗关注的症状
5. **不过度陈述相关性** - 指明强度和置信水平

### 必需的免责声明
```
⚠️ 医疗免责声明
此分析识别您症状数据中的模式和相关性。
它不是医疗诊断。

如有以下情况，务必咨询医疗保健提供者：
- 严重或恶化症状
- 新症状或令人担忧的症状
- 医疗建议或治疗

如遇紧急情况，立即拨打急救电话。
```

## 测试清单
- [ ] 测试有限数据（1-2 周）
- [ ] 测试丰富数据（3 个月以上）
- [ ] 测试相关性准确性
- [ ] 测试红旗警示检测
- [ ] 测试诱因识别
- [ ] 验证建议可操作性
- [ ] 测试边缘情况（严重症状、急诊）
- [ ] 验证所有免责声明存在

## 相关技能
- `medication-advisor`: 检查症状是否为药物副作用
- `health-trend-analyzer`: 更广泛的健康趋势分析
- `health-insights`: 综合所有数据的健康洞察
