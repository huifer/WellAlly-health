# 健康趋势分析器技能设计

## 概述
**技能名称**: `health-trend-analyzer`
**目的**: 分析所有健康数据源随时间的健康趋势，识别模式、变化和潜在问题。

## 描述
分析一段时间内健康数据的趋势和模式。关联药物、症状、生命体征、化验结果和其他健康指标的变化。识别令人担忧的趋势、改善情况，并提供数据驱动的洞察。当用户询问健康趋势、模式、随时间的变化或"我的健康状况有什么变化？"时使用。

## 数据集成

### 数据源
- **个人档案** (`data/profile.json`): BMI 随时间的变化
- **药物** (`data/medications/`): 药物依从性、剂量变化、开始/停止模式
- **症状** (`data/symptoms/`): 症状频率、严重程度模式、相关性
- **过敏** (`data/allergies.json`): 过敏反应模式
- **辐射** (`data/radiation-records.json`): 累积辐射趋势
- **手术** (`data/手术记录/`): 手术历史影响分析
- **出院小结** (`data/出院小结/`): 恢复轨迹
- **情绪** (`data/mood/`): 心理健康趋势
- **周期** (`data/cycle/`): 女性健康模式
- **饮食** (`data/diet/`): 营养模式影响

## 核心功能

### 1. 多维度趋势分析
- **体重/BMI 趋势**: 随时间追踪变化，与饮食和运动关联
- **症状模式**: 识别反复出现的症状、季节性模式、诱因
- **药物趋势**: 依从性模式、有效性、副作用趋势
- **生命体征**: 血压、心率趋势（如果记录）
- **化验结果**: 追踪多次报告中的生化指标
- **情绪模式**: 关联情绪与睡眠、饮食、药物、周期

### 2. 相关性分析引擎
- **药物-症状相关性**: 识别新药物是否与症状变化相关
- **生活方式影响**: 关联饮食/睡眠与症状和情绪
- **治疗效果**: 衡量治疗是否导致改善
- **过敏模式**: 追踪过敏反应并识别诱因
- **周期-症状相关性**: 用于女性健康追踪

### 3. 变化检测
- **显著变化**: 警告快速体重变化、新症状、药物变化
- **恶化模式**: 早期识别健康状况下降
- **改善识别**: 强调积极的健康变化
- **阈值警报**: 接近危险水平时警告（辐射、BMI 极值）

### 4. 预测性洞察
- **风险评估**: 基于趋势识别风险因素
- **预防建议**: 基于模式建议预防措施
- **早期预警**: 在问题变得严重之前预测

## 输出格式

### 文本报告
```
健康趋势分析报告
生成时间: 2025-12-31

📊 体重/BMI 趋势
├─ 当前 BMI: 24.5（正常范围）
├─ 6 个月变化: -2.3 kg（-3.5%）
├─ 趋势: 逐渐减重
└─ 评估: 积极趋势，在健康范围内

💊 药物模式
├─ 当前药物: 3 种
├─ 依从率: 87%
├─ 最近变化: 2025-11-15 新增赖诺普利
└─ 相关性: 药物变化后血压改善

⚠️ 症状模式
├─ 最频繁: 头痛（过去一个月 4 次）
├─ 趋势: 频率下降
├─ 潜在诱因: 与睡眠质量识别出相关性
└─ 建议: 继续监测睡眠模式

🧪 化验结果趋势
├─ 胆固醇: 从 240 降至 210（改善）
├─ 血糖: 正常范围内稳定
└─ 上次检查: 30 天前 - 需要复查

📈 总体评估
├─ 改善中: 体重管理、胆固醇
├─ 稳定: 血糖、情绪
├─ 需要关注: 药物依从性
└─ 建议: 继续当前饮食，改善用药提醒
```

### 可视化图表（ASCII）
- 体重、BMI 的时间序列图
- 症状频率的柱状图
- 症状-药物相关性的热图

### JSON 导出
```json
{
  "analysis_date": "2025-12-31",
  "period_analyzed": "6_months",
  "trends": {
    "weight": {"direction": "decreasing", "magnitude": -2.3, "assessment": "positive"},
    "symptoms": {"most_frequent": "头痛", "frequency_trend": "decreasing"},
    "medications": {"adherence": 87, "changes": 1}
  },
  "correlations": [
    {"type": "medication-symptom", "description": "赖诺普利与头痛减少相关"},
    {"type": "lifestyle-symptom", "description": "睡眠差与头痛频率相关"}
  ],
  "recommendations": [
    "继续当前体重管理方法",
    "提高用药依从性（目前 87%）",
    "30 天后复查化验"
  ]
}
```

## 技术实现

### 数据读取策略
```python
# 伪代码：数据聚合
def analyze_trends(time_period="6_months"):
    trends = {}

    # 读取档案计算 BMI
    profile = read_json("data/profile.json")
    trends['bmi'] = calculate_bmi_trends(profile, time_period)

    # 读取药物分析依从性
    medications = read_all_json("data/medications/")
    trends['medications'] = analyze_medication_adherence(medications, time_period)

    # 读取症状分析模式
    symptoms = read_all_json("data/symptoms/")
    trends['symptoms'] = analyze_symptom_patterns(symptoms, time_period)

    # 相关性分析
    correlations = find_correlations(trends)

    return generate_report(trends, correlations)
```

### 分析算法
1. **时间序列分析**: 检测趋势、季节性、异常值
2. **相关性分析**: 皮尔逊/斯皮尔曼相关系数
3. **模式识别**: 循环事件检测
4. **统计分析**: 均值、中位数、标准差、百分位数
5. **变化点检测**: 识别何时发生显著变化

### 依赖项
- **数据要求**: 需要历史数据（至少 3 个月才能进行有意义的趋势分析）
- **可选**: `pandas`、`numpy` 用于统计分析
- **无外部 API**: 所有分析本地进行

## 用户交互示例

### 示例 1: 一般健康趋势
**用户**: "过去 6 个月我的健康有什么变化？"
**技能**: 运行完整分析，生成显示体重、症状、药物趋势的综合报告

### 示例 2: 症状分析
**用户**: "为什么我总是头疼？"
**技能**: 分析症状模式，与睡眠、饮食、药物关联，识别潜在诱因

### 示例 3: 药物有效性
**用户**: "我的降压药有效吗？"
**技能**: 关联药物开始日期与血压读数、症状、化验结果

### 示例 4: 体重趋势
**用户**: "我在减肥吗？"
**技能**: 分析体重数据、BMI 趋势，与饮食和运动数据关联

## 允许的工具
- `Read`: 读取 JSON 数据文件
- `Grep`: 在数据中搜索特定模式
- `Glob`: 按模式查找数据文件
- `Write`: 生成报告（可选，也可以直接显示）

## 安全与隐私
- 所有数据保持本地
- 无外部 API 调用
- 无医疗建议，仅趋势分析
- 关于局限性的明确免责声明
- 建议应由医疗专业人员审查

## 未来增强
1. 机器学习以改进模式识别
2. 与可穿戴设备数据集成
3. 针对令人担忧的趋势的自动警报
4. 导出为医生友好的格式
5. 与人群健康数据对比

## 测试清单
- [ ] 使用最少数据测试（1-2 个月）
- [ ] 使用全面数据测试（1 年以上）
- [ ] 测试相关性准确性
- [ ] 测试边缘情况（缺失数据、记录空白）
- [ ] 测试多种并发健康问题
- [ ] 验证报告可读性
- [ ] 测试 JSON 导出/导入

## 相关命令
- `/query`: 检索特定数据点
- `/report`: 生成综合健康报告
- `/save-report`: 分析医疗图像
- `/symptom`: 记录新症状
- `/medication`: 药物数据
