# 睡眠专家技能设计

## 概述
**技能名称**: `sleep-specialist`
**目的**: 提供个性化睡眠分析、睡眠质量改善建议和睡眠健康指导。

## 描述
分析用户的睡眠模式、质量和相关因素（如咖啡因、药物、压力），提供个性化睡眠改善建议和睡眠卫生指导。在需要改善睡眠、分析睡眠问题或询问"为什么我总是睡不好？"时使用。

## 数据集成

### 数据源
- **睡眠记录** (如果追踪): 睡眠时长、质量
- **症状记录** (`data/symptoms/`): 睡眠相关症状
- **情绪记录** (`data/mood/`): 睡眠与情绪关联
- **药物记录** (`data/medications/`): 影响睡眠的药物
- **饮食记录** (`data/diet/`): 咖啡因、酒精摄入
- **运动记录**: 运动对睡眠的影响

### 相关命令
- `/symptom`: 睡眠相关症状
- `/mood`: 情绪记录

## 核心功能

### 1. 睡眠模式分析
- **睡眠时长分析**: 平均时长、趋势、一致性
- **睡眠质量评估**: 深度睡眠、浅睡、醒来次数
- **时间模式**: 就寝时间、起床时间规律性
- **周间模式**: 工作日vs周末睡眠差异
- **年龄基准**: 与年龄组推荐对比

### 2. 睡眠影响因素
- **药物影响**: 药物对睡眠的影响
- **饮食因素**: 咖啡因、酒精、进食时间
- **运动影响**: 运动时间、强度对睡眠的作用
- **压力因素**: 压力、焦虑与睡眠质量
- **环境因素**: 温度、光线、噪音
- **屏幕时间**: 电子设备使用对睡眠的影响

### 3. 睡眠问题诊断
- **失眠模式**: 入睡困难、早醒、睡眠维持
- **睡眠呼吸暂停**: 鼾声、呼吸暂停症状
- **不宁腿综合征**: 腿部不适症状
- **昼夜节律**: 睡眠时相问题
- **其他障碍**: 根据症状识别

### 4. 睡眠改善方案
- **睡眠卫生优化**: 环境和习惯改进
- **昼夜节律调节**: 光照、时间调整
- **放松技巧**: 呼吸、冥想、渐进放松
- **行为改变**: CBT-I 认知行为疗法技术
- **生活方式调整**: 饮食、运动、压力管理

## 输出格式

### 睡眠分析报告
```
😴 睡眠分析报告
生成时间: 2025-12-31
分析周期: 过去 30 天

📊 睡眠概况

总睡眠评分: 58/100 ⚠️ 需要改善

睡眠时长:
├─ 平均: 6.2 小时
├─ 推荐范围: 7-9 小时（45岁）
├─ 差距: -0.8 至 -2.8 小时
├─ 最短: 5.0 小时
├─ 最长: 7.5 小时
└─ 趋势: 略微改善中

睡眠质量:
├─ 自评质量: 5.5/10
├─ 深度睡眠感觉: 不足
├─ 入睡时间: 平均 30 分钟（偏长）
├─ 夜醒次数: 平均 2 次/晚
├─ 清醒感: 疲劳 70% 早晨
└─ 午后困倦: 4-5 天/周

规律性:
├─ 就寝时间: 晚 10:30（范围 9:45-11:30）
├─ 起床时间: 早 6:30（范围 6:00-7:15）
├─ 规律性评分: 6.5/10（中等）
├─ 周末延迟: 平均 +1.5 小时
└─ 建议: 提高规律性

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔍 睡眠影响因素分析

药物因素:
赖诺普利:
├─ 影响: 可能增加夜间尿频
├─ 相关症状: 夜间起夜 1-2 次
└─ 建议: 晚上早点服用，减少晚间饮水

二甲双胍:
├─ 影响: 对睡眠无直接影响
└─ 建议: 继续随餐服用

阿司匹林:
├─ 影响: 无
└─ 建议: 无需调整

饮食因素:
咖啡因:
├─ 摄入时间: 最后一杯 下午 4:00
├─ 摄入量: 平均 3.5 杯/天
├─ 影响: 可能影响入睡（半衰期 ~6小时）
└─ 建议: 下午 2:00 后避免咖啡因

酒精:
├─ 摄入: 2-3 次/周，晚间
├─ 影响: 破坏睡眠质量，减少深度睡眠
└─ 建议: 避免睡前 3-4 小时饮酒

晚间进食:
├─ 时间: 晚餐 晚 7:30
├─ 睡前进食: 偶尔（30%）
├─ 影响: 消化可能影响睡眠
└─ 建议: 睡前 3 小时避免大餐

运动因素:
├─ 运动天数: 3-4 天/周
├─ 晚间运动: 偶尔（晚间 8-9 点）
├─ 影响: 晚间运动可能延迟入睡
└─ 建议: 避免睡前 3 小时剧烈运动

屏幕时间:
├─ 屏幕时间: 平均 6.5 小时/天
├─ 睡前使用: 95% 夜晚
├─ 时间: 睡前 1 小时仍在使用
├─ 蓝光影响: 抑制褪黑素
└─ 影响: ❌ 显著影响入睡和睡眠质量

压力因素:
├─ 高压力日: 3-4 天/周
├─ 工作压力: 主要压力源
├─ 思考过度: 80% 夜晚睡前
└─ 影响: ❌ 显著影响入睡

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ 睡眠问题识别

主要问题:

1. 睡眠时长不足 [严重]
   ├─ 平均: 6.2 小时
   ├─ 需要: 7-9 小时
   ├─ 缺失: 0.8-2.8 小时/晚
   └─ 影响: 疲劳、认知功能下降、健康风险

2. 入睡困难 [中度]
   ├─ 入睡时间: 平均 30 分钟
   ├─ 正常: <20 分钟
   ├─ 频率: 70% 夜晚
   └─ 原因: 思维活跃、屏幕时间

3. 睡眠质量差 [中度]
   ├─ 深度睡眠感觉不足
   ├─ 夜醒频繁
   ├─ 早晨疲劳
   └─ 原因: 多因素（见上）

4. 昼夜节律失调 [轻度]
   ├─ 规律性: 中等
   ├─ 周末延迟 +1.5 小时
   └─ 影响: "社会性时差"

可能排除的障碍:
□ 失眠症 - 符合部分标准，建议咨询医生
□ 睡眠呼吸暂停 - 如打鼾严重，建议评估
□ 不宁腿综合征 - 无相关症状报告

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 睡眠改善方案

优先级 1: 睡眠卫生优化 [立即开始]

睡眠环境:
□ 温度: 保持卧室 18-20°C
□ 黑暗: 使用遮光窗帘、眼罩
□ 安静: 白噪音机、耳塞
□ 床铺: 舒适床垫和枕头
□ 用途: 床只用于睡眠和性生活（不工作/看电视）

就寝程序:
时间: 就寝前 60-90 分钟开始

晚 9:00 - 调暗屋内灯光
├─ 降低天花板灯亮度
├─ 使用暖光（黄色/橙色）
└─ 帮助褪黑素分泌

晚 9:15 - 完成所有任务
├─ 收拾整理
├─ 准备明日物品
└─ 写下明日待办（清空大脑）

晚 9:30 - 停止屏幕时间 ⭐ 关键
├─ 关闭电视
├─ 放下手机（移出卧室）
├─ 停止电脑工作
└─ 避免蓝光暴露

替代活动（晚 9:30-10:15）:
□ 阅读（纸质书）
□ 轻柔伸展
□ 冥想或深呼吸
□ 听轻音乐或有声书
□ 温水浴

晚 10:15 - 个人卫生
□ 刷牙、洗脸
□ 如有必要，使用浴室
□ 舒适睡衣

晚 10:30 - 上床
□ 关灯
□ 舒适体位
□ 放松练习

早晨程序（支持昼夜节律）:
早 6:30 - 固定起床时间（每天）
├─ 即使没睡够也按时起床
├─ 拉开窗帘，让阳光进入
└─ 或到户外晒 10-15 分钟太阳

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

优先级 2: 生活方式调整 [第1周开始]

咖啡因管理:
├─ 限制总量: ≤2-3 杯/天
├─ 最后时间: 下午 2:00 前 ⚠️
├─ 替代: 下午喝花草茶、水
└─ 预期改善: 入睡更快，睡眠更深

晚间饮水:
├─ 晚上 7:00 后减少饮水
├─ 晚 8:00 后避免大口喝水
├─ 就寝前小口即可
└─ 预期改善: 减少夜间起夜

酒精管理:
├─ 避免: 睡前 3-4 小时
├─ 限制: 每周 ≤1-2 次
└─ 预期改善: 提高深度睡眠质量

晚间进食:
├─ 晚餐时间: 晚 6:30-7:30
├─ 睡前: 避免 3 小时内大餐
├─ 轻饿: 可少量吃点清淡零食
└─ 推荐: 睡前 1 小时避免任何食物

运动时间调整:
├─ 早晨/下午: 最佳
├─ 晚间: 避免 3-4 小时前剧烈运动
├─ 替代: 晚间可做轻柔伸展、瑜伽
└─ 预期改善: 入睡更容易

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

优先级 3: 放松与压力管理 [第1周开始]

就寝放松技巧（选择 1-2 种）:

4-7-8 呼吸法（5 分钟）:
├─ 舌尖抵住上颚后方牙齿
├─ 用鼻子吸气 4 拍
├─ 屏气 7 拍
├─ 用嘴呼气 8 拍（发出呼呼声）
└─ 重复 4-8 次

渐进式肌肉放松（10-15 分钟）:
├─ 依次紧张和放松各组肌肉
├─ 从脚趾开始到头部
├─ 每组: 紧张 5 秒，放松 10 秒
└─ 非常适合睡前

身体扫描冥想（10-20 分钟）:
├─ 平躺，闭眼
├─ 注意身体各部位感觉
├─ 从脚趾到头顶
└─ 释放任何紧张

可视化技巧（5-10 分钟）:
├─ 想象宁静的地方
├─ 感受平静的感觉
└─ 专注于放松场景

压力管理:
□ 日间: 压力大时使用呼吸技巧
□ 傍晚: 完成工作，设定边界
□ 就寝前: "大脑倾倒"（写下所有想法）
□ 预期: 减少睡前过度思考

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

优先级 4: 认知行为技巧 [第2周开始]

刺激控制（重建床=睡眠的联系）:
□ 仅困倦时上床
□ 如 20 分钟睡不着 → 起床
├─ 做安静活动（阅读、伸展）
├─ 仅困倦时回床
└─ 必要时重复
□ 床只用于睡眠/性生活
□ 不在床上看电视、手机、吃东西
□ 固定起床时间（无论睡多久）

睡眠限制（提高睡眠效率）:
当前: 在床时间 9 小时，实际睡眠 6.2 小时
效率: 69%（低于 85% 目标）

调整:
├─ 第 1 周: 就寝推迟到 晚 11:00
├─ 在床时间: 7.5 小时
├─ 目标: 提高效率到 85%+
├─ 一旦达标: 逐步提前就寝 15 分钟
└─ 最终目标: 7-8 小时在床时间

认知重构:
□ 睡眠焦虑 → "没关系，身体会睡够需要"
□ "必须睡 8 小时" → "睡够需要的就好"
□ "一夜没睡完" → "即使睡得少也能应付"
□ 关注: 质量比数量更重要

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 4 周改善计划

第 1 周: 基础建立
目标:
□ 固定就寝时间 晚 10:30
□ 固定起床时间 早 6:30
□ 停止睡前屏幕时间（晚 9:30）
□ 下午 2:00 后无咖啡因
□ 尝试就寝放松技巧

预期:
├─ 入睡时间缩短
├─ 睡眠时长增加 0.5-1 小时
└─ 第 2-3 天可能感觉累（正常）

成功指标:
✓ 5/7 天按时就寝
✓ 屏幕时间减少
✓ 入睡时间 <25 分钟

第 2 周: 巩固习惯
继续第 1 周所有措施
新增:
□ 完善睡眠环境
□ 晚 7:00 后减少饮水
□ 尝试睡眠限制（如果效率低）
□ 开始认知重构技巧

预期:
├─ 睡眠更连续
├─ 夜醒减少
├─ 早晨感觉更清醒

成功指标:
✓ 就寝一致性 6/7 天
✓ 睡眠时长 6.5-7 小时
✓ 睡眠效率 >75%

第 3 周: 优化调整
根据进展调整:
├─ 如果效率 >85%: 提前就寝 15 分钟
├─ 如果仍困难: 坚持当前计划
└─ 继续所有良好习惯

预期:
├─ 睡眠稳定改善
├─ 日间精力提升
├─ 情绪改善

成功指标:
✓ 睡眠时长 7+ 小时
✓ 质量评分 7+/10
✓ 日间精力良好

第 4 周: 长期维持
目标:
├─ 稳定睡眠 7-8 小时
├─ 建立所有习惯为常规
├─ 应对偶尔的睡眠不佳
└─ 规划长期维持策略

评估:
如果显著改善:
✓ 继续当前所有习惯
✓ 庆祝成功！
✓ 定期评估维持

如果改善有限:
⚠️ 建议咨询:
□ 睡眠专科医生
□ 认知行为疗法（CBT-I）
□ 排除睡眠障碍

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📈 进度追踪

每日追踪:
☑️ 就寝时间
☑️ 入睡时间（估计）
☑️ 夜醒次数
☑️ 估计睡眠时长
☑️ 早晨醒来感觉（1-10）
☑️ 日间精力水平（1-10）
☑️ 遵循睡眠程序（是/否）

每周评估:
□ 平均睡眠时长
□ 入睡时间趋势
□ 睡眠质量评分
□ 规律性评分
□ 遵循计划百分比

月度回顾:
□ 与基线对比
□ 成功的策略
□ 需要调整的方面
□ 下月目标

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 睡眠知识教育

睡眠周期:
├─ 每 90 分钟一个周期
├─ 典型 4-6 个周期/晚
├─ 包含: 浅睡、深睡、REM
└─ 在周期末醒来感觉更好

睡眠与年龄:
├─ 新生儿: 14-17 小时
├─ 学龄: 9-11 小时
├─ 青少年: 8-10 小时
├─ 成年人: 7-9 小时 ← 您
└─ 老年人: 7-8 小时

为什么睡眠重要:
✓ 大脑清理代谢废物
✓ 记忆巩固
✓ 身体修复
✓ 免疫系统强化
✓ 激素平衡
✓ 情绪调节

睡眠 debt:
├─ 可以累积
├─ 难以完全"还清"
├─ 最好规律作息
└─ 不要依赖周末补觉

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ 何时寻求专业帮助

如果以下情况持续 >3 周:

□ 长期入睡困难（>30 分钟）
□ 频繁夜醒（>3 次/晚）
□ 早醒无法再睡
□ 日间功能严重受损
□ 打鼾 + 呼吸暂停
□ 腿部不适 + 不可控移动
□ 睡中行为异常

推荐:
□ 睡眠专科医生
□ 多导睡眠图检查
□ CBT-I 认知行为治疗

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 立即行动清单

今天开始:
☑️ 设定固定就寝时间（晚 10:30）
☑️ 设定固定起床时间（早 6:30）
☑️ 准备睡眠环境（遮光、温度、安静）
☑️ 充电手机放在卧室外
☑️ 买眼罩或耳塞（如需要）

本周准备:
☑️ 调暗卧室灯光（暖光灯泡）
☑️ 准备纸质书或杂志
☑️ 学习放松技巧
☑️ 告知家人您的睡眠计划
☑️ 午后避免咖啡因

成功关键:
✓ 一致性比完美重要
✓ 改变需要时间（2-4 周）
✓ 偶尔失败没关系
✓ 关注改善而非完美
✓ 睡眠是投资，不是浪费时间

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💬 睡眠专家寄语

睡眠是健康的基石。您目前平均 6.2 小时，需要提升到
7-9 小时。好消息是，大多数睡眠问题都可以通过
行为改变改善。

坚持执行这个计划 2-4 周，您应该会看到显著改善。
睡眠是可以训练的，您的身体会学习更快入睡和更深睡眠。

今晚就开始吧！😴

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
由个人健康信息系统生成
睡眠专家
祝您好梦！
```

## 技术实现

### 睡眠质量评分
```python
def calculate_sleep_score(sleep_data, profile):
    """计算睡眠质量评分（0-100）"""

    factors = {
        "duration": score_duration(sleep_data, profile),
        "quality": score_quality(sleep_data),
        "regularity": score_regularity(sleep_data),
        "efficiency": score_efficiency(sleep_data),
        "daytime_functioning": score_daytime(sleep_data)
    }

    weights = {
        "duration": 0.30,
        "quality": 0.25,
        "regularity": 0.20,
        "efficiency": 0.15,
        "daytime_functioning": 0.10
    }

    overall = sum(factors[k] * weights[k] for k in factors)

    return {
        "overall": round(overall),
        "factors": factors,
        "recommendations": generate_sleep_recommendations(factors)
    }
```

## 用户交互示例

### 示例 1: 睡眠评估
**用户**: "我总是睡不好，能帮我分析一下吗？"
**技能**: 全面分析睡眠模式、影响因素，提供改善方案

### 示例 2: 失眠问题
**用户**: "我总是入睡困难，有什么方法？"
**技能**: 识别原因，提供放松技巧和刺激控制疗法

### 示例 3: 睡眠环境
**用户**: "如何优化我的睡眠环境？"
**技能**: 提供环境优化建议（温度、光线、声音、床铺）

## 测试清单
- [ ] 测试睡眠模式分析准确性
- [ ] 验证影响因素识别
- [ ] 测试建议可实施性
- [ ] 验证放松技巧指导清晰
- [ ] 测试不同睡眠问题场景
- [ ] 验证何时转介专业帮助

## 相关技能
- `health-trend-analyzer`: 睡眠趋势分析
- `symptom-pattern-analyzer`: 睡眠相关症状
- `wellness-coach`: 整体生活方式改善
