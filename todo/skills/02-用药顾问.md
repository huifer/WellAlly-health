# 用药顾问技能设计

## 概述
**技能名称**: `medication-advisor`
**目的**: 智能用药管理，提供全面的安全检查、相互作用检测和依从性优化。

## 描述
提供智能用药指导，包括相互作用检查、过敏冲突检测、剂量时间优化、依从性追踪和安全建议。在添加新药物、检查相互作用、优化用药计划或询问"我可以同时服用这些药吗？"时使用。

## 数据集成

### 数据源
- **药物记录** (`data/medications/`): 当前药物清单和历史
- **过敏信息** (`data/allergies.json`): 用于冲突检查的过敏信息
- **个人档案** (`data/profile.json`): 年龄、体重用于剂量考虑
- **症状记录** (`data/symptoms/`): 追踪药物副作用
- **药物相互作用数据库**: 药物-药物相互作用的参考数据

### 相关命令
- `/medication`: 药物录入的主要命令
- `/interaction`: 检查特定药物相互作用
- `/allergy`: 过敏信息

## 核心功能

### 1. 全面相互作用检查
- **药物-药物相互作用**: 检查所有当前药物与新添加药物的相互作用
  - 5 级严重程度系统（A/B/C/D/X）
  - 详细的相互作用描述
  - 管理建议
- **药物-过敏相互作用**: 与已知过敏交叉引用
- **药物-疾病相互作用**: 基于健康状况检查禁忌症
- **药物-食物相互作用**: 识别食物相互作用（如葡萄柚、乳制品）
- **药物-补充剂相互作用**: 检查草药和补充剂相互作用

### 2. 用药安全分析
- **重复治疗检测**: 识别重复药物或同类药物
- **剂量范围检查**: 验证处方剂量在安全范围内
- **年龄适宜性检查**: 标记对年龄组不适当的药物
- **禁忌症检测**: 根据手术、植入物、状况检查
- **副作用概况**: 解释常见和严重副作用
- **黑框警告**: 突出 FDA 黑框警告

### 3. 依从性优化
- **计划优化**: 建议药物给药的最佳时间
- **提醒策略**: 个性化提醒建议
- **药片组织**: 建议药片组织策略
- **漏服指导**: 提供漏服剂量说明
- **依从性障碍**: 识别并解决依从性挑战

### 4. 用药教育
- **用途说明**: 药物治疗的内容
- **工作原理**: 简单术语解释作用机制
- **预期时间线**: 何时预期效果
- **治疗持续时间**: 需要服药多长时间
- **储存说明**: 适当的储存条件
- **处置指导**: 安全处置方法

## 输出格式

### 相互作用检查报告
```
💊 药物相互作用检查
生成时间: 2025-12-31

🔍 正在分析: 赖诺普利 10mg（新药）

✅ 药物-药物相互作用
├─ 与二甲双胍 500mg: 严重程度 A - 无已知相互作用
├─ 与阿司匹林 81mg: 严重程度 B - 轻微相互作用
│  └─ 详情: 可能轻微降低 ACE 抑制剂效果
│  └─ 行动: 监测血压，无需更改
└─ 与布洛芬按需服用: 严重程度 D - 中度相互作用
   └─ 详情: 可能降低降压效果，肾脏负担
   └─ 行动: 限制布洛芬使用，监测肾功能

⚠️ 药物-过敏检查
└─ 无已知 ACE 抑制剂过敏

📊 剂量评估
├─ 处方: 10mg 每日
├─ 典型范围: 10-40mg 每日
├─ 根据您的体重（75kg）: 正常范围内
└─ 年龄适宜: ✅

🎯 建议
1. 可以继续服用赖诺普利 10mg 每日
2. 限制非甾体抗炎药使用（布洛芬），考虑对乙酰氨基酚代替
3. 开始后每周监测血压
4. 注意: 头晕、干咳、肾功能变化
5. 早晨服用以减少夜间尿频

⏰ 最佳时间
├─ 早晨（8 AM）: 赖诺普利、阿司匹林
├─ 早餐时: 二甲双胍
└─ 按需: 布洛芬（谨慎使用）

📅 随访
├─ 血压检查: 开始后 1 周
├─ 化验（肾功能）: 开始后 2 周
└─ 医生预约: 开始后 1 个月
```

### 用药计划优化
```
⏰ 优化的用药计划
生成时间: 2025-12-31

🌅 早晨（6:00-8:00 AM）
├─ 07:00 AM - 赖诺普利 10mg
│  ├─ 服用: 空腹，早餐前 30 分钟
│  ├─ 用: 一杯水送服
│  └─ 原因: 更好吸收，早晨血压控制
└─ 07:30 AM - 阿司匹林 81mg
   ├─ 服用: 随早餐
   └─ 原因: 减少胃部不适

🍽️ 早餐（8:00 AM）
└─ 08:00 AM - 二甲双胍 500mg
   ├─ 服用: 随餐服用以减少胃肠道副作用
   └─ 原因: 更好的耐受性

🌙 晚上
└─ 无需晚间用药

📋 依从性提示
1. 使用有早晚隔间的药片盒
2. 设置手机闹钟每天 7:00 AM
3. 在床头柜上放水杯
4. 用简单检查清单追踪依从性

💊 药片盒设置
周: 周一 - 周日
├─ 早晨隔间: 赖诺普利 10mg + 阿司匹林 81mg
├─ 早餐隔间: 二甲双胍 500mg
└─ 按需隔间: 布洛芬（谨慎使用）
```

## 技术实现

### 相互作用数据库结构
```json
{
  "drug_interactions": {
    "lisinopril": {
      "nsaids": {
        "severity": "D",
        "description": "可能降低降压效果",
        "mechanism": "前列腺素合成抑制",
        "recommendation": "限制非甾体抗炎药使用，监测血压和肾功能"
      },
      "potassium_supplements": {
        "severity": "C",
        "description": "高钾血症风险",
        "recommendation": "监测钾水平"
      }
    }
  },
  "drug_allergies": {
    "ace_inhibitors": {
      "cross_reactivity": ["lisinopril", "enalapril", "benazepril"],
      "reaction_type": "血管神经性水肿、咳嗽、低血压"
    }
  },
  "contraindications": {
    "lisinopril": {
      "pregnancy": "X - 绝对禁忌",
      "angioedema_history": "X - 禁忌",
      "renal_artery_stenosis": "D - 慎用"
    }
  }
}
```

## 用户交互示例

### 示例 1: 添加新药物
**用户**: "医生给我开了赖诺普利 10mg。和我其他药物一起吃安全吗？"
**技能**: 运行全面相互作用检查，提供详细安全报告

### 示例 2: 相互作用检查
**用户**: "我可以和降压药一起吃布洛芬吗？"
**技能**: 检查特定相互作用，提供严重程度和建议

### 示例 3: 计划优化
**用户**: "什么时间吃我的药最好？"
**技能**: 分析所有药物，根据药代动力学建议最佳时间

### 示例 4: 副作用问题
**用户**: "赖诺普利有什么副作用需要注意？"
**技能**: 提供全面的副作用概况和何时寻求帮助

## 安全与伦理

### 关键安全规则
1. **绝不提供剂量建议** - 仅验证处方剂量在标准范围内
2. **绝不推荐开始/停止药物** - 始终遵从处方医生的指示
3. **始终建议咨询医生** - 在做任何改变之前
4. **始终包含免责声明** - 这是信息而非医疗建议
5. **始终报告严重程度 X 相互作用** - "请勿服用 - 立即咨询医生"

### 必须包含的免责声明
```
⚠️ 重要免责声明
此信息仅供教育目的，并非医疗建议。
在以下情况前务必咨询医疗保健提供者：
- 开始新药物
- 停止当前药物
- 改变剂量或时间表
- 忽视相互作用警告

如遇紧急情况，立即拨打急救电话或联系毒物控制中心。
```

## 测试清单
- [ ] 测试无相互作用（无问题）
- [ ] 测试严重程度 X 相互作用（应阻止）
- [ ] 测试多个中度相互作用
- [ ] 测试过敏冲突
- [ ] 测试重复治疗
- [ ] 测试边缘情况（未知药物、儿科剂量）
- [ ] 验证所有安全警告存在
- [ ] 测试计划优化逻辑

## 相关技能
- `health-trend-analyzer`: 追踪一段时间内的药物有效性
- `symptom-pattern-analyzer`: 关联药物与症状
- `emergency-card`: 包括关键药物相互作用
