# 技术实现细节

## 系统架构

### 存储架构
- **存储方式**: JSON 文件 + 文件系统目录结构
- **数据组织**: 按检查类型和日期分层存储
- **索引机制**: 全局索引文件支持快速查询
- **备份策略**: 原始图片备份保持数据完整性

### 命令系统
- **实现方式**: Claude Code Slash Commands
- **命令位置**: `.claude/commands/` 目录
- **扩展性**: 易于添加新命令
- **参数解析**: 支持多种参数格式

### 专家系统架构
- **多专科 Skill**: 9大专科独立 Skill 定义
- **Subagent 架构**: 每个专科独立分析和推理
- **会诊协调器**: 并行处理 + 意见整合算法
- **优先级排序**: 基于临床紧急度和风险程度

## 核心技术

### 图片识别
- **AI 视觉分析**: 使用先进的多模态大模型
- **类型识别**: 自动区分生化检查和影像检查
- **文字提取**: OCR 技术提取图片中的文字信息
- **结构化处理**: 将非结构化文本转换为结构化数据

### 数据提取
- **智能识别**: 识别检查项目、数值、单位、参考范围
- **异常检测**: 自动标记超出参考范围的指标
- **数据验证**: 多层验证确保数据准确性
- **格式标准化**: 统一的日期和数值格式

### 辐射计算模型
- **基础剂量**: 基于医学标准的辐射剂量数据库
- **体表面积调整**: 根据用户BSA调整剂量计算
  - 使用 Mosteller 公式计算体表面积
  - 调整系数考虑个体差异
- **累积剂量追踪**: 年度累积和历史记录
- **衰减模型**: 往年辐射按 50%/年 衰减计算
- **安全评估**: 基于国际辐射防护标准

### 会诊系统
- **专科识别**: 自动识别数据涉及的专科
- **并行分析**: 多个专科专家同时分析
- **意见整合**: 智能整合各专科意见
- **优先级排序**: 按临床重要性排序
- **综合建议**: 提供综合管理建议

## 数据隐私设计

### 隐私保护原则
- **本地存储**: 所有数据存储在本地文件系统
- **无云端依赖**: 不上传到任何云端服务
- **无外部数据库**: 不依赖第三方数据库
- **完全私有化**: 用户完全掌控数据

### 安全措施
- **文件权限**: 依赖操作系统的文件权限控制
- **备份建议**: 建议用户定期备份数据目录
- **数据加密**: 未来可支持文件级加密（待实现）

## 扩展性设计

### 新增检查类型
- 在 `.claude/commands/` 添加新的命令文件
- 定义新的数据结构和存储格式
- 更新索引文件结构

### 新增专科专家
- 在 `.claude/specialists/` 添加新的专科文件
- 定义专科特定的分析逻辑
- 在会诊协调器中注册新专科

### 数据分析功能
- 添加新的查询命令
- 实现趋势分析算法
- 生成统计报告

## 性能优化

### 文件组织
- 按年月分层存储，减少单个目录文件数量
- 索引文件支持快速检索
- 原始图片独立存储

### 查询优化
- 索引优先，减少文件读取
- 按日期范围查询优化
- 并行处理多个文件

## 未来技术升级

- [ ] 添加数据加密功能
- [ ] 支持数据导出为多种格式（PDF、Excel）
- [ ] 实现健康趋势分析和可视化
- [ ] 添加指标对比功能
- [ ] 支持多维度统计分析
- [ ] 实现健康提醒和预警功能
- [ ] 添加数据同步和备份功能
